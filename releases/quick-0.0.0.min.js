/**
 * Copyright (c) 2014, 2015 Diogo Schneider
 * 
 * Released under The MIT License (MIT)
 * 
 * https://github.com/dgsprb/quick
 */

(function(){var c={UP:0,DOWN:1,LEFT:2,RIGHT:3,A:4,B:5,X:6,Y:7,SELECT:8,START:9},l=function(){function a(){function p(){a()}for(var e=0;e<k.length;++e)if(!k[e].complete){setTimeout(p,100);return}t=new d;b()}function b(){function a(){requestAnimationFrame(b)}if(m){var p=Date.now(),d=f.getContext("2d");c=!c;l.update();null!=x?x.sync()&&(x=null):(z&&(z=!1,t=t.getNext()),t.sync()?(z=!0,x=t.getTransition()):t.update());q.update();for(var e=0;e<y.length;++e)y[e].render(d);p=Date.now()-p;setTimeout(a,g-p)}}
function p(){function b(a){a()}window.requestAnimationFrame||(window.requestAnimationFrame=b)}function e(){f.style.width=window.innerWidth+"px";f.style.height=window.innerHeight+"px"}var d,f,c=!0,g,k,l,m,z=!1,r="Game",v=1,y=[],t,q,x,n=0,A=0;return{init:function(b,c){f=b;n=f.width;A=f.height;d=c;k=document.getElementsByTagName("img");l=new u;m=!0;q=new D;addEventListener("resize",e,!1);e();p();this.setFrameTime();for(var g=0;g<v;++g)y.push(new E);a()},clearCanvas:function(){f.height=f.height},fadeOut:function(){q.fadeOut()},
getCanvasBottom:function(){return A-1},getCanvasCenter:function(){return new w(this.getCanvasCenterX(),this.getCanvasCenterY())},getCanvasCenterX:function(){return Math.floor(this.getCanvasWidth()/2)},getCanvasCenterY:function(){return Math.floor(this.getCanvasHeight()/2)},getCanvasHeight:function(){return A},getCanvasRight:function(){return n-1},getCanvasWidth:function(){return n},getController:function(b){return l.getController(b)},getEveryOther:function(){return c},getFrameTime:function(){return g},
mute:function(){q.mute()},paint:function(b,a){y[a||0].add(b)},play:function(b){q.play(b)},playTheme:function(b){q.playTheme(b)},random:function(b){b=Math.random()*(b+1);return Math.floor(b)},stopTheme:function(){q.stopTheme()},setFrameTime:function(b){g=b||30},setName:function(b){r=b;document.title=r},setNumberOfLayers:function(b){v=b}}}(),F=function(){function a(b,a,e){var d=document.createElement("canvas");d.width=b.width;d.height=b.height;var c=d.getContext("2d");c.translate(a?d.width:0,e?d.height:
0);c.scale(a?-1:1,e?-1:1);c.drawImage(b,0,0);return d}return{flip:function(b){return a(b,!1,!0)},mirror:function(b){return a(b,!0,!1)},rotate:function(b,a){if(0==a%360)return b;var e=a*Math.PI/180,d=document.createElement("canvas");90==a||270==a?(d.width=b.height,d.height=b.width):(d.width=b.width,d.height=b.height);var c=d.getContext("2d");c.translate(d.width/2,d.height/2);c.rotate(e);c.drawImage(b,-b.width/2,-b.height/2);return d}}}(),G=function(){function a(){this.active={};this.device=null;this.held=
{}}a.prototype.keyDown=function(b){return this.active[b]};a.prototype.keyPush=function(b){return this.active[b]&&!this.held[b]};a.prototype.setDevice=function(b){this.device=b};a.prototype.update=function(){if(this.device){this.held={};var b=this.active;this.active=this.device.getCommands();for(var a in this.active)b[a]&&(this.held[a]=!0)}};return a}(),H=function(){function a(b){this.id=b||0}var b={};b[12]=c.UP;b[13]=c.DOWN;b[14]=c.LEFT;b[15]=c.RIGHT;b[0]=c.A;b[1]=c.B;b[2]=c.X;b[3]=c.Y;b[9]=c.START;
b[8]=c.SELECT;a.prototype.getCommands=function(){var a={};-.5>u.getGamepadAxes(this.id)[1]?a[c.UP]=!0:.5<u.getGamepadAxes(this.id)[1]&&(a[c.DOWN]=!0);-.5>u.getGamepadAxes(this.id)[0]?a[c.LEFT]=!0:.5<u.getGamepadAxes(this.id)[0]&&(a[c.RIGHT]=!0);for(var e in b)u.getGamepadButtons(this.id,e)&&(a[b[e]]=!0);return a};return a}(),u=function(){function a(){this.controllerQueue=[];this.controllers=[];this.deviceQueue=[];this.deviceRequestQueue=[];this.gamepads=0;this.waitKeyboard();this.waitTouch()}a.getGamepads=
function(){return navigator.getGamepads?navigator.getGamepads():[]};a.getGamepadAxes=function(b){return a.getGamepads()[b]?a.getGamepads()[b].axes:[]};a.getGamepadButtons=function(b,p){return a.getGamepads()[b]?a.getGamepads()[b].buttons[p].pressed:!1};a.prototype.addDevice=function(b){this.deviceQueue.push(b);this.checkQueues()};a.prototype.checkGamepads=function(){a.getGamepads()[this.gamepads]&&this.addDevice(new H(this.gamepads++))};a.prototype.checkQueues=function(){if(0<this.deviceRequestQueue.length&&
0<this.deviceQueue.length){var b=this.deviceRequestQueue.shift(),a=this.deviceQueue.shift();b.setDevice(a)}};a.prototype.getController=function(b){b=b||0;if(this.controllers.length<b+1){var a=new G;this.controllers.push(a);this.deviceRequestQueue.push(a);this.checkQueues()}return this.controllers[b]};a.prototype.update=function(){this.checkGamepads();for(var b in this.controllers)this.controllers[b].update()};a.prototype.waitKeyboard=function(){function b(e){removeEventListener("keydown",b,!1);a.addDevice(new I(e))}
var a=this;addEventListener("keydown",b,!1)};a.prototype.waitTouch=function(){function b(e){removeEventListener("touchstart",b,!1);a.addDevice(new J)}var a=this;addEventListener("touchstart",b,!1)};return a}(),I=function(){function a(a){function e(a){a.preventDefault();d.buffer[b[a.keyCode]]=!0}var d=this;this.buffer={};addEventListener("keydown",e,!1);addEventListener("keyup",function(a){d.buffer[b[a.keyCode]]=!1},!1);e(a)}var b={};b[38]=c.UP;b[69]=c.UP;b[73]=c.UP;b[40]=c.DOWN;b[68]=c.DOWN;b[75]=
c.DOWN;b[37]=c.LEFT;b[83]=c.LEFT;b[74]=c.LEFT;b[39]=c.RIGHT;b[70]=c.RIGHT;b[76]=c.RIGHT;b[32]=c.A;b[18]=c.B;b[17]=c.X;b[16]=c.Y;b[13]=c.START;b[127]=c.SELECT;a.prototype.getCommands=function(){var b={},a;for(a in this.buffer)this.buffer[a]&&(b[a]=!0);return b};return a}(),E=function(){function a(){this.elements=[]}a.prototype.add=function(b){this.elements.push(b)};a.prototype.render=function(b){for(var a=0;a<this.elements.length;++a)this.elements[a].render(b);this.elements.length=0};return a}(),K=
function(){function a(){this.gameObjects=[];this.nextObjects=[];this.expiration=-1;this.isExpired=!1;this.tick=-1;this.transition=null}a.prototype.add=function(b){b.setScene(this);this.nextObjects.push(b);b.move(-1*b.getSpeedX(),-1*b.getSpeedY())};a.prototype.build=function(b,a){a=a||B;for(var c=0;c<b.length;++c)for(var d=b[c],f=0;f<d.length;++f){var h=b[c][f];h&&(h=new a(h),h.setTop(c*h.getHeight()),h.setLeft(f*h.getWidth()),this.add(h))}};a.prototype.expire=function(){this.isExpired=!0};a.prototype.sync=
function(){if(this.isExpired)return!0;for(var b=[],a=[],c=0;c<this.gameObjects.length;++c){var d=this.gameObjects[c];d.update();d.sync()?d.getEssential()&&this.expire():(d.getSolid()&&a.push(d),b.push(d),l.paint(d,d.getLayerIndex()))}c=a.length;for(d=0;d<c-1;++d)for(var f=a[d],h=d+1;h<c;++h){var g=a[h];f.hasCollision(g)&&(f.onCollision(g),g.onCollision(f))}this.gameObjects=b.concat(this.nextObjects);this.nextObjects=[];++this.tick==this.expiration&&this.expire();return!1};a.prototype.getNext=function(){return null};
a.prototype.getTick=function(){return this.tick};a.prototype.getTransition=function(){return this.transition};a.prototype.setExpiration=function(b){this.expiration=b};a.prototype.setTransition=function(b){this.transition=b};a.prototype.update=function(){};return a}(),D=function(){function a(){this.isMute=this.isFading=!1;this.nextThemeName=null;this.queue={};this.theme=null;this.volume=100}a.prototype.fadeOut=function(){this.theme&&(this.isFading=!0,this.volume=100)};a.prototype.mute=function(){(this.isMute=
!this.isMute)?this.theme.pause():this.theme.play()};a.prototype.pause=function(){this.theme&&this.theme.pause()};a.prototype.play=function(b){this.isMute||(this.queue[b]=!0)};a.prototype.playTheme=function(b){this.theme&&0<this.theme.currentTime?(this.nextThemeName=b,this.isFading||this.fadeOut()):(this.stopTheme(),this.theme=document.getElementById(b),0<this.theme.currentTime&&(this.theme.currentTime=0),this.isMute||(this.theme.volume=1,this.theme.play()))};a.prototype.resume=function(){this.isMute||
this.theme.paused&&this.theme.play()};a.prototype.stopTheme=function(){this.theme&&(this.theme.pause(),this.theme.currentTime=0)};a.prototype.update=function(){for(var b in this.queue){var a=document.getElementById(b);a.pause();0<a.currentTime&&(a.currentTime=0);a.volume=.3;a.play()}this.queue={};this.isFading&&(0<--this.volume?this.theme.volume=this.volume/100:(this.isFading=!1,this.theme=null,this.nextThemeName&&(this.playTheme(this.nextThemeName),this.nextThemeName=null)))};return a}(),J=function(){function a(){var b=
this;this.buffer={};addEventListener("touchend",function(a){a.preventDefault();b.buffer[c.A]=!1},!1);addEventListener("touchmove",function(a){a.preventDefault();b.buffer[c.LEFT]=!1},!1);addEventListener("touchstart",function(a){a.preventDefault();b.buffer[c.A]=!0},!1)}a.prototype.getCommands=function(){var b={},a;for(a in this.buffer)this.buffer[a]&&(b[a]=!0);return b};return a}(),w=function(){function a(b,a){this.setAccelerationX();this.setAccelerationY();this.setSpeedX();this.setSpeedY();this.setX(b||
0);this.setY(a||0)}a.prototype.bounceX=function(){this.setSpeedX(-1*this.getSpeedX());this.moveX(this.getSpeedX())};a.prototype.bounceY=function(){this.setSpeedY(-1*this.getSpeedY());this.moveY(this.getSpeedY())};a.prototype.getAccelerationX=function(){return this.accelerationX};a.prototype.getAccelerationY=function(){return this.accelerationY};a.prototype.getSpeedX=function(){return this.speedX};a.prototype.getSpeedY=function(){return this.speedY};a.prototype.getX=function(){return this.x};a.prototype.getY=
function(){return this.y};a.prototype.move=function(b,a){this.moveX(b);this.moveY(a)};a.prototype.moveX=function(b){this.setX(this.getX()+b)};a.prototype.moveY=function(b){this.setY(this.getY()+b)};a.prototype.setAccelerationX=function(b){this.accelerationX=b||0};a.prototype.setAccelerationY=function(b){this.accelerationY=b||0};a.prototype.setSpeedX=function(b){this.speedX=b||0};a.prototype.setSpeedY=function(b){this.speedY=b||0};a.prototype.setX=function(b){this.x=b};a.prototype.setY=function(b){this.y=
b};a.prototype.stop=function(){this.setSpeedX(0);this.setSpeedY(0)};a.prototype.sync=function(){this.setSpeedX(this.getSpeedX()+this.accelerationX);this.setSpeedY(this.getSpeedY()+this.accelerationY);this.move(this.getSpeedX(),this.getSpeedY());return!1};return a}(),m=function(){function a(b,a,c,d){w.call(this,b,a);this.setHeight(d||0);this.setWidth(c||0)}a.prototype=Object.create(w.prototype);a.prototype.bounceFrom=function(b){(0>this.getSpeedX()&&b.getLeft()||0<this.getSpeedX()&&b.getRight())&&
this.bounceX();(0>this.getSpeedY()&&b.getTop()||0<this.getSpeedY()&&b.getBottom())&&this.bounceY()};a.prototype.getBottom=function(){return this.getY()+this.getHeight()-1};a.prototype.getCenter=function(){return new w(this.getCenterX(),this.getCenterY())};a.prototype.getCenterX=function(){return this.getX()+this.getHalfWidth()};a.prototype.getCenterY=function(){return this.getY()+this.getHalfHeight()};a.prototype.getCollision=function(b){var a=new L,c=this.getTop(),d=this.getRight(),f=this.getBottom(),
h=this.getLeft(),g=this.getCenterX(),k=this.getCenterY(),l=b.getTop(),m=b.getRight(),n=b.getBottom();b=b.getLeft();g<=b&&d<m?a.setRight():g>=m&&h>b&&a.setLeft();k<=l&&f<n?a.setBottom():k>=n&&c>l&&a.setTop();return a};a.prototype.getHalfHeight=function(){return Math.floor(this.getHeight()/2)};a.prototype.getHalfWidth=function(){return Math.floor(this.getWidth()/2)};a.prototype.getHeight=function(){return this.height};a.prototype.getLeft=function(){return this.getX()};a.prototype.getRight=function(){return this.getX()+
this.getWidth()-1};a.prototype.getTop=function(){return this.getY()};a.prototype.getWidth=function(){return this.width};a.prototype.hasCollision=function(b){return this.getLeft()>b.getRight()||this.getRight()<b.getLeft()||this.getTop()>b.getBottom()||this.getBottom()<b.getTop()?!1:!0};a.prototype.increase=function(b,a){this.increaseWidth(b);this.increaseHeight(a)};a.prototype.increaseHeight=function(b){this.setHeight(this.getHeight()+b)};a.prototype.increaseWidth=function(b){this.setWidth(this.getWidth()+
b)};a.prototype.setBottom=function(b){this.setY(b-this.getHeight()+1)};a.prototype.setCenter=function(b){this.setCenterX(b.getX());this.setCenterY(b.getY())};a.prototype.setCenterX=function(b){this.setX(b-this.getHalfWidth())};a.prototype.setCenterY=function(b){this.setY(b-this.getHalfHeight())};a.prototype.setHeight=function(b){this.height=b};a.prototype.setLeft=function(b){this.setX(b)};a.prototype.setRight=function(b){this.setX(b-this.getWidth()+1)};a.prototype.setSize=function(b,a){this.setWidth(b);
1<arguments.length?this.setHeight(a):this.setHeight(b)};a.prototype.setTop=function(b){this.setY(b)};a.prototype.setWidth=function(b){this.width=b};return a}(),L=function(){function a(){this.isTop=this.isRight=this.isLeft=this.isBottom=!1}a.prototype.getBottom=function(){return this.isBottom};a.prototype.getLeft=function(){return this.isLeft};a.prototype.getRight=function(){return this.isRight};a.prototype.getTop=function(){return this.isTop};a.prototype.setBottom=function(b){this.isBottom=b||!0};
a.prototype.setLeft=function(b){this.isLeft=b||!0};a.prototype.setRight=function(b){this.isRight=b||!0};a.prototype.setTop=function(b){this.isTop=b||!0};return a}(),v=function(){function a(b,a){this.duration=a||0;this.image=b||new Image}a.prototype.getDuration=function(){return this.duration};a.prototype.getHeight=function(){return this.image.height};a.prototype.getImage=function(){return this.image};a.prototype.getWidth=function(){return this.image.width};return a}(),C=function(){function a(b){this.setFrames(b)}
a.prototype.getHeight=function(){return this.frame.getHeight()};a.prototype.getImage=function(){return this.frame.getImage()};a.prototype.getWidth=function(){return this.frame.getWidth()};a.prototype.setFrameIndex=function(b){return b<this.frames.length&&-1<b?(this.frameIndex=b,this.tick=0,this.frame=this.frames[b],!0):!1};a.prototype.setFrames=function(b){this.frames=b||[new v];this.setFrameIndex(0)};a.prototype.update=function(){var b=!1;if(this.frame.getDuration()&&++this.tick>this.frame.getDuration()){var a=
this.frameIndex+1;a==this.frames.length&&(b=!0,a=0);this.setFrameIndex(a)}return b};return a}(),n=function(){function a(){m.call(this);this.delegate=this.animation=null}a.prototype=Object.create(m.prototype);a.prototype.getImage=function(){return this.animation.getImage()};a.prototype.onAnimationLoop=function(){this.delegate&&this.delegate.onAnimationLoop&&this.delegate.onAnimationLoop()};a.prototype.render=function(b){if(this.animation){var a=this.getImage(),c=Math.floor(this.getX()),d=Math.floor(this.getY());
b.drawImage(a,c,d,this.getWidth(),this.getHeight())}};a.prototype.setAnimation=function(b){this.animation!=b&&(this.animation=b,this.animation.setFrameIndex(0),this.setHeight(this.animation.getHeight()),this.setWidth(this.animation.getWidth()))};a.prototype.setDelegate=function(b){this.delegate=b};a.prototype.setImage=function(b){this.setAnimation(new C([new v(b)]))};a.prototype.setImageId=function(b){this.setImage(document.getElementById(b))};a.prototype.sync=function(){if(this.animation&&this.animation.update())this.onAnimationLoop();
return m.prototype.sync.call(this)};return a}(),r=function(){function a(b){n.call(this,b);this.boundary=null}a.prototype=Object.create(n.prototype);a.prototype.setBoundary=function(b){this.boundary=b};a.prototype.offBoundary=function(){this.delegate&&this.delegate.offBoundary&&this.delegate.offBoundary()};a.prototype.sync=function(){var b=n.prototype.sync.call(this);this.boundary&&!this.hasCollision(this.boundary)&&this.offBoundary();return b};return a}(),k=function(){function a(){r.call(this);this.color=
null;this.layerIndex=0;this.isSolid=this.isExpired=this.isEssential=!1;this.isVisible=!0;this.scene=null;this.tags={};this.tick=0}a.prototype=Object.create(r.prototype);a.prototype.addTag=function(b){this.tags[b]=!0};a.prototype.expire=function(){this.isExpired=!0};a.prototype.getColor=function(){return this.color};a.prototype.getExpired=function(){return this.isExpired};a.prototype.getLayerIndex=function(){return this.layerIndex};a.prototype.getScene=function(){return this.scene};a.prototype.getTick=
function(){return this.tick};a.prototype.hasTag=function(b){return this.tags[b]?!0:!1};a.prototype.getEssential=function(){return this.isEssential};a.prototype.getSolid=function(){return this.isSolid};a.prototype.onCollision=function(b){this.delegate&&this.delegate.onCollision&&this.delegate.onCollision(b)};a.prototype.setColor=function(b){this.color=b};a.prototype.setEssential=function(b){this.isEssential=void 0==b||b};a.prototype.setLayerIndex=function(b){this.layerIndex=b||0};a.prototype.setScene=
function(b){this.scene=b};a.prototype.setSolid=function(b){this.isSolid=void 0==b||b};a.prototype.setVisible=function(b){this.isVisible=void 0==b||b};a.prototype.render=function(b){if(this.isVisible){if(this.color){var a=Math.floor(this.getX()),c=Math.floor(this.getY());b.fillStyle=this.color;b.fillRect(a,c,this.getWidth(),this.getHeight())}r.prototype.render.call(this,b)}};a.prototype.sync=function(){if(this.getExpired())return!0;++this.tick;return r.prototype.sync.call(this)};a.prototype.update=
function(){this.delegate&&this.delegate.update&&this.delegate.update()};return a}(),M=function(){function a(a){m.call(this);this.setText(a||"")}a.prototype=Object.create(k.prototype);a.prototype.parse=function(a){for(var c=0,e=0,d=0,f=0,h=0;h<this.text.length;++h){var g=this.text[h];" "==g?d+=4:"\n"==g?(d=0,f+=c+0):(g=document.getElementById(g+"Font"),a&&a.drawImage(g,this.getX()+d,this.getY()+f,g.width,g.height),d+=g.width+0,d>e&&(e=d),g.height>c&&(c=g.height))}this.setWidth(e);this.setHeight(f+
c)};a.prototype.render=function(a){this.parse(a)};a.prototype.setText=function(a){this.text=a;this.parse()};return a}(),B=function(){function a(a){k.call(this);this.setImageId(a)}a.prototype=Object.create(k.prototype);return a}(),N=function(){function a(){k.call(this);this.setColor("Black");this.setHeight(l.getCanvasHeight());this.increase=l.getCanvasWidth()/32}a.prototype=Object.create(k.prototype);a.prototype.sync=function(){if(this.getWidth()>l.getCanvasWidth())return!0;this.increaseWidth(this.increase);
l.paint(this);return k.prototype.sync.call(this)};return a}();window.com||(window.com={});window.com.dgsprb||(window.com.dgsprb={});window.com.dgsprb.quick={Animation:C,BaseTile:B,BaseTransition:N,CommandEnum:c,Frame:v,GameObject:k,ImageFactory:F,Point:w,Quick:l,Rect:m,Scene:K,Text:M}})();
